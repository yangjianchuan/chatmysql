{"messages": [{"role": "user", "content": "前年有多少家公司连续3个月签约金额下滑"}, {"role": "assistant", "content": "```sql\nwith monthly_data as (\n    select \n        `COMPANY_NAME` as company,\n        date_format(`fdate`, '%Y-%m') as month,\n        sum(`SIGNED_AMOUNT`) as monthly_signed_amount\n    from `contracts`\n    where year(`fdate`) = year(current_date)-2\n    group by `COMPANY_NAME`, date_format(`fdate`, '%Y-%m')\n),\ntrend_data as (\n    select\n        company,\n        month,\n        monthly_signed_amount,\n        lag(monthly_signed_amount, 1) over (partition by company order by month) as prev_month_amount,\n        lag(monthly_signed_amount, 2) over (partition by company order by month) as prev_prev_month_amount\n    from monthly_data\n)\nselect \n    company,\n    monthly_signed_amount,\n    prev_month_amount,\n    prev_prev_month_amount\nfrom trend_data\nwhere monthly_signed_amount < prev_month_amount\n  and prev_month_amount < prev_prev_month_amount\n  and prev_month_amount is not null\n  and prev_prev_month_amount is not null;\n```"}]}
{"messages": [{"role": "user", "content": "去年均价多少"}, {"role": "assistant", "content": "```sql\nselect \n    sum(`SIGNED_AMOUNT`) / sum(`SIGNED_AREA`) as \"均价（元/㎡）\"\nfrom \n    `contracts`\nwhere \n    year(`fdate`) = year(curdate()) - 1;\n```"}]}